(function () {
  "use strict";
  const toggle =
    document.getElementById("nav-toggle") ||
    document.querySelector(".nav__toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const overlay = document.getElementById("mobile-overlay");
  const body = document.body;
  if (!toggle || !mobileMenu || !overlay) return;
  let isOpen = false;
  function toggleMenu() {
    isOpen = !isOpen;
    toggle.classList.toggle("nav__toggle--open", isOpen);
    toggle.setAttribute("aria-expanded", isOpen);
    toggle.setAttribute(
      "aria-label",
      isOpen ? "Close mobile menu" : "Open mobile menu"
    );
    mobileMenu.classList.toggle("nav__mobile--open", isOpen);
    mobileMenu.setAttribute("aria-hidden", !isOpen);
    overlay.classList.toggle("nav__overlay--visible", isOpen);
    overlay.setAttribute("aria-hidden", !isOpen);
    body.style.overflow = isOpen ? "hidden" : "";
    const announcement = isOpen ? "Mobile menu opened" : "Mobile menu closed";
    announceToScreenReader(announcement);
    if (isOpen) {
      const firstLink = mobileMenu.querySelector(".nav__mobile-link");
      if (firstLink) {
        setTimeout(() => firstLink.focus(), 100);
      }
    } else {
      toggle.focus();
    }
  }
  function announceToScreenReader(message) {
    let liveRegion = document.getElementById("mobile-menu-announcements");
    if (!liveRegion) {
      liveRegion = document.createElement("div");
      liveRegion.id = "mobile-menu-announcements";
      liveRegion.setAttribute("aria-live", "polite");
      liveRegion.setAttribute("aria-atomic", "true");
      liveRegion.className = "sr-only";
      document.body.appendChild(liveRegion);
    }
    liveRegion.textContent = message;
    setTimeout(() => {
      liveRegion.textContent = "";
    }, 1000);
  }
  function closeMenu() {
    if (isOpen) toggleMenu();
  }
  toggle.addEventListener("click", toggleMenu);
  overlay.addEventListener("click", closeMenu);
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape" && isOpen) {
      closeMenu();
    }
  });
  const mobileLinks = mobileMenu.querySelectorAll(".nav__mobile-link");
  mobileLinks.forEach(function (link) {
    link.addEventListener("click", closeMenu);
  });
  window.addEventListener("resize", function () {
    if (window.innerWidth >= 768 && isOpen) {
      closeMenu();
    }
  });
  document.addEventListener("keydown", function (e) {
    if (!isOpen || e.key !== "Tab") return;
    const focusableElements = mobileMenu.querySelectorAll(
      'a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])'
    );
    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];
    if (e.shiftKey) {
      if (document.activeElement === firstElement) {
        e.preventDefault();
        lastElement.focus();
      }
    } else {
      if (document.activeElement === lastElement) {
        e.preventDefault();
        firstElement.focus();
      }
    }
  });
})();
